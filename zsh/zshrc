export EDITOR=nvim

export UNAME="$(uname)"
if [[ $UNAME != "Linux" && $UNAME != "Darwin" ]]; then
	echo "abort: unknown UNAME: $UNAME"
	exit 1
fi

if [[ $UNAME == "Linux" ]]; then
	source ~/_dotfiles/zsh/zshrc.linux
elif [[ $UNAME == "Darwin" ]]; then
	source ~/_dotfiles/zsh/zshrc.macos
fi

# https://github.com/ohmyzsh/ohmyzsh/wiki/Themes
ZSH_THEME="eastwood"
COMPLETION_WAITING_DOTS="true"
DISABLE_UNTRACKED_FILES_DIRTY="true"

plugins=(
	git
	fzf
	# fzf (https://github.com/junegunn/fzf)
	# CTRL-T (search files from pwd)
	# CTRL-R (search bash history)
	# ALT-C (search dirs, cd into them)
)

source $ZSH/oh-my-zsh.sh
export PATH="$HOME/.local/bin:$PATH"

# flyctl
export FLYCTL_INSTALL="$HOME/.fly"
export PATH="$FLYCTL_INSTALL/bin:$PATH"

alias cdx="cd ~/_dev"
alias cdz="cd ~/_zone"
alias cdd="cd ~/_dotfiles"

alias srczsh="source ~/.zshrc"
alias cfgzsh="(cd ~ && nvim .zshrc)"
alias cfggit="(cd ~ && nvim .gitconfig)"
alias cfgvim="(cd ~/.config/nvim && nvim .)"

alias ls="exa"
alias l="ls -l"
alias la="ls -la"

alias v="nvim"
alias vi="nvim"
alias vim="nvim"

alias todo="nvim ~/_zone/todo.txt"

alias lg="lazygit"

alias yarnx="yarn $@ && git config --unset core.hooksPath && echo hooks uninstalled"

# == tmux-sessioniser ==
switch() {
	if [[ $# -eq 1 ]]; then
		selected=$1
	else
		selected=$(find ~/_dev -mindepth 1 -maxdepth 1 -type d | fzf)
	fi

	if [[ -z $selected ]]; then
		return 1
	fi

	selected_name=$(basename "$selected" | tr . _)
	tmux_running=$(pgrep tmux)

	if [[ -z $TMUX ]] && [[ -z $tmux_running ]]; then
		tmux new-session -s $selected_name -c $selected
		return 0
	fi

	if ! tmux has-session -t=$selected_name 2> /dev/null; then
		tmux new-session -ds $selected_name -c $selected
	fi

	tmux switch-client -t $selected_name
}

autoload -U add-zsh-hook

# == docker ==
# docker-destroy-containers
function ddc() {
	docker ps -aq | xargs docker rm -f
}

# docker-destroy-untagged-images
function ddui() {
	docker image ls | grep '<none>' | awk '{print $3}' | xargs docker rmi -f
}
